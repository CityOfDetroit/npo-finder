"use strict";(self.webpackChunknpo_finder=self.webpackChunknpo_finder||[]).push([[179],{554:function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var r,o=function(){function t(n,r){e(this,t),this.form=null,this.controller=r,this.user=null,this.init(document.getElementById(n),this)}return n(t,[{key:"init",value:function(e,t){var n=this,r=document.createElement("form"),o=document.createElement("label"),a=document.createElement("input"),i=(document.createElement("ul"),document.createElement("datalist")),s=document.createElement("i");r.addEventListener("submit",(function(e){n.submit(e,t)})),s.className="fas fa-map-marker-alt",o.innerText="Find your NPO:",o.setAttribute("for","geocoder-input"),a.type="text",a.setAttribute("list","addresses-list"),a.placeholder="Enter address",a.setAttribute("id","geocoder-input"),a.setAttribute("autocomplete","off"),a.addEventListener("keyup",(function(e){n.inputChange(e,t)})),i.setAttribute("id","addresses-list"),r.appendChild(o),r.appendChild(a),r.appendChild(s),r.appendChild(i),e.appendChild(r),this.form=r}},{key:"supplementGeocoder",value:function(e,t,n){var r=e.split(",");r=(r=r[0]).split(" ");var o="",a=r.length;r.forEach((function(e,t){o+=e,t<a&&t+1!==a&&(o+="+")}));var i="https://opengis.detroitmi.gov/opengis/rest/services/BaseUnits/BaseUnitGeocoder/GeocodeServer/findAddressCandidates?Address=&Address2=&Address3=&Neighborhood=&City=&Subregion=&Region=&Postal=&PostalExt=&CountryCode=&SingleLine=".concat(o,"&outFields=*&maxLocations=&matchOutOfRange=true&langCode=&locationType=&sourceCountry=&category=&location=&distance=&searchExtent=&outSR=&magicKey=&f=json");try{fetch(i).then((function(e){return e.json()})).then((function(e){if("suggestions"===n)e.candidates.forEach((function(e){var n=document.createElement("option");""===e.attributes.parcel_id?(n.value=e.address,n.setAttribute("data-parsel","no-parcel")):(n.value="".concat(e.address," RECOMMENDED"),n.setAttribute("data-parsel",e.attributes.parcel_id)),n.onclick=function(e){t.selectSuggestion(e,t)},t.form.childNodes[3].appendChild(n)}));else{var r="https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/City_of_Detroit_Boundary/FeatureServer/0/query?where=&objectIds=&time=&geometry=".concat(e.candidates[0].location.x,"%2C+").concat(e.candidates[0].location.y,"&geometryType=esriGeometryPoint&inSR=4326&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=4326&returnGeometry=true&returnCentroid=false&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnDistinctValues=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=geojson&token=");try{fetch(r).then((function(e){return e.json()})).then((function(n){n.features.length&&t.controller.dataManager.buildData(e.candidates[0],t.controller)}))}catch(o){}}}))}catch(s){}}},{key:"selectSuggestion",value:function(e,t){var n=null;"no-parcel"===(n="SPAN"===e.target.tagName?e.target.parentNode:e.target).attributes[0].value?(t.clearSuggestions(t),t.supplementGeocoder(n.innerText,t,"submit")):t.supplementGeocoder(n.innerText,t,"submit")}},{key:"inputChange",value:function(e,t){switch(e.key){case"Enter":""!=e.target.value&&void 0!=e.target.value&&t.supplementGeocoder(e.target.value,t,"submit");break;case"ArrowDown":case"ArrowUp":case"ArrowRight":case"ArrowLeft":break;case void 0:""!=e.target.value&&void 0!=e.target.value&&t.supplementGeocoder(e.target.value,t,"submit");break;default:t.clearSuggestions(t),t.supplementGeocoder(e.target.value,t,"suggestions")}}},{key:"clearSuggestions",value:function(e){for(;e.form.childNodes[3].firstChild;)e.form.childNodes[3].removeChild(e.form.childNodes[3].firstChild)}},{key:"submit",value:function(e,t){e.preventDefault(),t.supplementGeocoder(e.target[0].value,t,"submit")}}]),t}(),a=function(){function t(){e(this,t)}return n(t,[{key:"creatPanel",value:function(e,t){var n=null;"all"==e?(n=t.panel.createMarkup(t.allNPOs),document.querySelector("#npo-results h2").innerText="All NPOs"):(n=t.panel.createMarkup(t.tempNPO),document.querySelector("#npo-results h2").innerText="Your NPO"),document.querySelector("#npo-results .npo-content").innerHTML=n,document.getElementById("npo-results").className="active"}},{key:"createMarkup",value:function(e){return"\n    ".concat(e.map((function(e){return'<article class="info-section">\n        <p><strong>Name:</strong> '.concat(e.attributes.police_officer,"</p>\n        <p><strong>Phone:</strong> ").concat(e.attributes.phone_number,"</p>\n        <p><strong>Email:</strong> ").concat(e.attributes.email,"</p>\n      </article>")})).join(""),"\n    ")}}]),t}(),i=function(){function t(){e(this,t)}return n(t,[{key:"getAllData",value:function(e){var t=new Promise((function(e,t){return fetch("https://opengis.detroitmi.gov/opengis/rest/services/PublicSafety/NeighborhoodPoliceOfficers/FeatureServer/0/query?where=1%3D1&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=*&returnGeometry=true&returnCentroid=false&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnDistinctValues=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=json&token=").then((function(e){return e.json()})).then((function(t){e(t)}))}));Promise.all([t]).then((function(t){var n=[],r=[];t[0].features.forEach((function(e,t){" "!=e.attributes.police_officer&&null!=e.attributes.police_officer&&(0==t?(n.push(e),r.push(e.attributes.police_officer)):r.includes(e.attributes.police_officer)||(n.push(e),r.push(e.attributes.police_officer)))})),e.allNPOs=n,e.panel.creatPanel("all",e)})).catch((function(e){console.log(e)}))}},{key:"buildData",value:function(e,t){e.address;var n=new Promise((function(t,n){var r="https://opengis.detroitmi.gov/opengis/rest/services/PublicSafety/NeighborhoodPoliceOfficers/FeatureServer/0/query?where=&objectIds=&time=&geometry=".concat(e.location.x,"%2C").concat(e.location.y,"&geometryType=esriGeometryPoint&inSR=&spatialRel=esriSpatialRelIntersects&distance=&units=esriSRUnit_Foot&relationParam=&outFields=*&returnGeometry=true&maxAllowableOffset=&geometryPrecision=&outSR=&havingClause=&gdbVersion=&historicMoment=&returnDistinctValues=false&returnIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&returnZ=false&returnM=false&multipatchOption=xyFootprint&resultOffset=&resultRecordCount=&returnTrueCurves=false&returnExceededLimitFeatures=false&quantizationParameters=&returnCentroid=false&sqlFormat=none&resultType=&featureEncoding=esriDefault&datumTransformation=&f=json");return fetch(r).then((function(e){return e.json()})).then((function(e){t(e)}))}));Promise.all([n]).then((function(e){t.tempNPO=e[0].features,t.panel.creatPanel("single",t)})).catch((function(e){console.log(e)}))}}]),t}(),s=function(){function t(){e(this,t),this.tempNPO=null,this.allNPOs=null,this.panel=new a,this.dataManager=new i,this.geocoder=new o("geocoder",this),this.initialLoad(this)}return n(t,[{key:"initialLoad",value:function(e){e.dataManager.getAllData(e)}},{key:"loadDefault",value:function(e){e.panel.creatPanel("all",e)}},{key:"closeAlert",value:function(e){"alert-overlay"===e.target.parentNode.parentNode.id?document.getElementById("alert-overlay").className="":document.getElementById("drill-down-overlay").className=""}}]),t}();window,r=new s,document.getElementById("clear-services-btn").addEventListener("click",(function(){document.getElementById("npo-results").className="",r.loadDefault(r),r.geocoder.form.reset()}))}},function(e){var t;t=554,e(e.s=t)}]);